[[!meta author="""http://smcv.pseudorandom.co.uk/"""]]

[[!meta authorurl="""http://smcv.pseudorandom.co.uk/"""]]

[[!meta title="""change to todo/Improving_the_efficiency_of_match__95__glob on ikiwiki"""]]

[[!meta permalink="http://ikiwiki.info/recentchanges/#change-c9b737cc8596f9421ba968e56839eb052e80e794"]]

<div id="change-c9b737cc8596f9421ba968e56839eb052e80e794" class="metadata">
<span class="desc"><br />Changed pages:</span>
<span class="pagelinks">

<a href="http://git.ikiwiki.info/?p=ikiwiki;a=blobdiff;f=doc/todo/Improving_the_efficiency_of_match__95__glob.mdwn;h=4fe14540fa3c543fb3240acdb63aa057e259bcfb;hp=de3cf48d3aae963943dfeb3aaffb2edd6f472ef8;hb=c9b737cc8596f9421ba968e56839eb052e80e794;hpb=d6ff694ff7a6a4700ccbbd5819907eac73cf065a" title="diff" rel="nofollow">[[diff|wikiicons/diff.png]]</a><a href="http://ikiwiki.info/ikiwiki.cgi?page=todo%2FImproving_the_efficiency_of_match__95__glob&amp;do=goto" rel="nofollow">todo/Improving the efficiency of match&#95;glob</a>


</span>
<span class="desc"><br />Changed by:</span>
<span class="committer">

<a href="http://smcv.pseudorandom.co.uk/" rel="nofollow">smcv</a>

</span>
<span class="desc"><br />Commit type:</span>
<span class="committype">web</span>
<span class="desc"><br />Date:</span>
<span class="changedate"><span class="relativedate" title="Sat, 20 Nov 2010 00:36:29 +0000">00:36:29 11/20/10</span></span>
<span class="desc"><br /></span>
</div>

<span class="revert">
<a href="http://ikiwiki.info/ikiwiki.cgi?rev=c9b737cc8596f9421ba968e56839eb052e80e794&amp;do=revert" title="revert" rel="nofollow">[[revert|wikiicons/revert.png]]</a>
</span>

<div class="changelog">


one more patch: but expanding the memoization is actually a slowdown for the docwiki<br />


</div>

<div class="diff">
<pre>
diff --git a/doc/todo/Improving_the_efficiency_of_match__95__glob.mdwn b/doc/todo/Improving_the_efficiency_of_match__95__glob.mdwn
index de3cf48..4fe1454 100644
--- a/doc/todo/Improving_the_efficiency_of_match__95__glob.mdwn
+++ b/doc/todo/Improving_the_efficiency_of_match__95__glob.mdwn
@@ -43,12 +43,19 @@ Here&#39;s my patch - please consider it! -- &#91;&#91;KathrynAndersen&#93;&#93;
 &gt;&gt;&gt;&gt;&gt;&gt; `/^/i` regexp that can be used without further modifiction in most
 &gt;&gt;&gt;&gt;&gt;&gt; cases. --&#91;&#91;Joey&#93;&#93; 
 
-&gt;&gt;&gt;&gt;&gt;&gt;&gt; Done, see `smcv/ready/glob-cache`.
+&gt;&gt;&gt;&gt;&gt;&gt;&gt; Done, see `smcv/ready/glob-cache` and `smcv/glob-cache-too-far`.
+&gt;&gt;&gt;&gt;&gt;&gt;&gt;
 &gt;&gt;&gt;&gt;&gt;&gt;&gt; Kathryn&#39;s patch is a significant improvement; my first patch on top of
-&gt;&gt;&gt;&gt;&gt;&gt;&gt; that is a trivial cleanup that speeds it up a little, and the other two
+&gt;&gt;&gt;&gt;&gt;&gt;&gt; that is a trivial cleanup that speeds it up a little, and the next two
 &gt;&gt;&gt;&gt;&gt;&gt;&gt; patches (using precompiled regexes) have surprisingly little effect
 &gt;&gt;&gt;&gt;&gt;&gt;&gt; (they don&#39;t slow it down either though, so either omit them or merge
-&gt;&gt;&gt;&gt;&gt;&gt;&gt; them, whichever). Detailed benchmark results --&#91;&#91;smcv&#93;&#93;
+&gt;&gt;&gt;&gt;&gt;&gt;&gt; them, whichever). Detailed benchmark results below.
+&gt;&gt;&gt;&gt;&gt;&gt;&gt;
+&gt;&gt;&gt;&gt;&gt;&gt;&gt; Moving the memoization to `glob2re` actually seems to slow things down
+&gt;&gt;&gt;&gt;&gt;&gt;&gt; again - I suspect the docwiki has few enough mentions of `user()` etc.
+&gt;&gt;&gt;&gt;&gt;&gt;&gt; that caching them is a waste of time, but perhaps it&#39;s not the most
+&gt;&gt;&gt;&gt;&gt;&gt;&gt; representative.
+&gt;&gt;&gt;&gt;&gt;&gt;&gt; --&#91;&#91;smcv&#93;&#93;
 
 --------------------------------------------------------------
 
@@ -120,9 +127,21 @@ master at time of branch:
      7.70    1.7814    79514   0.000022     IkiWiki::PageSpec::match_glob
      3.35    0.7756    59454   0.000013     &lt;anon&gt;:IkiWiki/Plugin/inline.pm:223
 
-&quot;&quot;&quot;&#93;&#93;
+`move memoization from match_glob to glob2re`:
+
+    time elapsed (wall):   28.7677
+    time running program:  23.9473  (83.24%)
+    time profiling (est.): 4.8205  (16.76%)
+    number of calls:       1360181
+    number of exceptions:  13
+    
+    %Time    Sec.     #calls   sec/call  F  name
+    13.98    3.3469     3408   0.000982     Text::Balanced::_match_tagged
+     8.85    2.1194    79514   0.000027     IkiWiki::PageSpec::match_glob
+     3.24    0.7750    59454   0.000013     &lt;anon&gt;:IkiWiki/Plugin/inline.pm:223
 
 --&#91;&#91;smcv&#93;&#93;
+&quot;&quot;&quot;&#93;&#93;
 
 --------------------------------------------------------------
 

</pre>
</div>

<!-- c9b737cc8596f9421ba968e56839eb052e80e794 -->

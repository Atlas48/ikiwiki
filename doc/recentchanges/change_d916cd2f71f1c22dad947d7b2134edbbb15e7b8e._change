[[!meta author="""http://smcv.pseudorandom.co.uk/"""]]

[[!meta authorurl="""http://smcv.pseudorandom.co.uk/"""]]

[[!meta title="""change to todo/want_to_avoid_ikiwiki_using_http_or_https_in_urls_to_allow_serving_both on ikiwiki"""]]

[[!meta permalink="http://ikiwiki.info/recentchanges/#change-d916cd2f71f1c22dad947d7b2134edbbb15e7b8e"]]

<div id="change-d916cd2f71f1c22dad947d7b2134edbbb15e7b8e" class="metadata">
<span class="desc"><br />Changed pages:</span>
<span class="pagelinks">

<a href="http://git.ikiwiki.info/?p=ikiwiki;a=blobdiff;f=doc/todo/want_to_avoid_ikiwiki_using_http_or_https_in_urls_to_allow_serving_both.mdwn;h=80925b458287767620d8862f782e77b1bd7dda63;hp=4fafc2bbc249ac9e22869129f8702e0a6d54a5ba;hb=d916cd2f71f1c22dad947d7b2134edbbb15e7b8e;hpb=178d6a16c2fff68edfbe6a1af5c8a9fa91db6039" title="diff" rel="nofollow">[[diff|wikiicons/diff.png]]</a><a href="http://ikiwiki.info/ikiwiki.cgi?page=todo%2Fwant_to_avoid_ikiwiki_using_http_or_https_in_urls_to_allow_serving_both&amp;do=goto" rel="nofollow">todo/want to avoid ikiwiki using http or https in urls to allow serving both</a>


</span>
<span class="desc"><br />Changed by:</span>
<span class="committer">

<a href="http://smcv.pseudorandom.co.uk/" rel="nofollow">smcv</a>

</span>
<span class="desc"><br />Commit type:</span>
<span class="committype">web</span>
<span class="desc"><br />Date:</span>
<span class="changedate"><span class="relativedate" title="Mon, 22 Nov 2010 19:45:02 +0000">19:45:02 11/22/10</span></span>
<span class="desc"><br /></span>
</div>

<span class="revert">
<a href="http://ikiwiki.info/ikiwiki.cgi?rev=d916cd2f71f1c22dad947d7b2134edbbb15e7b8e&amp;do=revert" title="revert" rel="nofollow">[[revert|wikiicons/revert.png]]</a>
</span>

<div class="changelog">


respond to feedback<br />


</div>

<div class="diff">
<pre>
diff --git a/doc/todo/want_to_avoid_ikiwiki_using_http_or_https_in_urls_to_allow_serving_both.mdwn b/doc/todo/want_to_avoid_ikiwiki_using_http_or_https_in_urls_to_allow_serving_both.mdwn
index 4fafc2b..80925b4 100644
--- a/doc/todo/want_to_avoid_ikiwiki_using_http_or_https_in_urls_to_allow_serving_both.mdwn
+++ b/doc/todo/want_to_avoid_ikiwiki_using_http_or_https_in_urls_to_allow_serving_both.mdwn
@@ -191,14 +191,41 @@ New API added by this branch:
   &gt; The new form for local urls will typically be only a little bit longer,
   &gt; except in the unusual case where the cgiurl is elsewhere. --&#91;&#91;Joey&#93;&#93;
 
+  &gt;&gt; So, have urlto(x, y) use `$local_url`? There are few calls, but IMO
+  &gt;&gt; they&#39;re for the most important things - wikilinks, img, map and
+  &gt;&gt; other ordinary hyperlinks. Using `$local_url` would be fine for
+  &gt;&gt; webserver-based use, but it does stop you browsing your wiki&#39;s
+  &gt;&gt; HTML over `file:///` (unless you set that as the base URL, but
+  &gt;&gt; then you can&#39;t move it around), and stops you moving simple
+  &gt;&gt; outputs (like the docwiki!) around.
+  &gt;&gt;
+  &gt;&gt; I personally think breaking the docwiki is enough to block that.
+  &gt;&gt;
+  &gt;&gt; How about this?
+  &gt;&gt;
+  &gt;&gt; * `urlto($link, $page)` with `$page` defined: relative
+  &gt;&gt; * `urlto($link, undef)`: local, starts with `/`
+  &gt;&gt; * `urlto($link)`: also local, as a side-effect
+  &gt;&gt; * `urlto($link, $anything, 1)` (but idiomatically, `$anything` is
+  &gt;&gt;   normally undef): absolute, starts with `http&#91;s&#93;://`
+  &gt;&gt;
+  &gt;&gt; --&#91;&#91;smcv&#93;&#93;
+
 * `IkiWiki::baseurl` has a new second argument which works like the
   third argument of `urlto`
 
+  &gt; I assume you have no objection to this --&#91;&#91;smcv&#93;&#93;
+
 * `IkiWiki::cgiurl` uses `$local_cgiurl` if passed `local_cgiurl =&gt; 1`
 
+  &gt; Possibly changed to making this always be local unless `cgiurl =&gt; $x`
+  &gt; is given: see below --&#91;&#91;smcv&#93;&#93;
+
 * `IkiWiki::cgiurl` omits the trailing `?` if given no named parameters
   except `cgiurl` and/or `local_cgiurl`
 
+  &gt; I assume you have no objection to this --&#91;&#91;smcv&#93;&#93;
+
 Bugs:
 
 * I don&#39;t think anything except `openid` calls `cgiurl` without also
@@ -211,10 +238,18 @@ Bugs:
 
   &gt; I agree that makes sense. --&#91;&#91;Joey&#93;&#93;
 
+  &gt;&gt; I&#39;m not completely sure whether you&#39;re agreeing with &quot;perhaps do this&quot;
+  &gt;&gt; or &quot;that looks too strange&quot;, so please disambiguate:
+  &gt;&gt; would you accept a patch that makes `cgiurl` default to a local
+  &gt;&gt; (starts-with-`/`) result? If you would, that&#39;d reduce the diff. --&#91;&#91;smcv&#93;&#93;
+
 * It occurs to me that `IkiWiki::cgiurl` could probably benefit from being
   exported? Perhaps also `IkiWiki::baseurl`?
 
-  &gt; Possibly, see &#91;&#91;firm_up_plugin_interface&#93;&#93;. --&#91;&#91;Joey&#93;&#93; 
+  &gt; Possibly, see &#91;&#91;firm_up_plugin_interface&#93;&#93;. --&#91;&#91;Joey&#93;&#93;
+
+  &gt;&gt; Not really part of this branch, though, so wontfix (unless you ask me
+  &gt;&gt; to do so). --&#91;&#91;smcv&#93;&#93;
 
 * Or, to reduce use of the unexported `baseurl` function, it might make
   sense to give `urlto` a special case that references the root of the wiki,
@@ -227,3 +262,5 @@ Bugs:
 
   &gt; AFACIS, `baseurl` is only called in 3 places so I don&#39;t think that&#39;s
   &gt; needed. --&#91;&#91;Joey&#93;&#93; 
+
+  &gt;&gt; OK, wontfix. --&#91;&#91;smcv&#93;&#93;

</pre>
</div>

<!-- d916cd2f71f1c22dad947d7b2134edbbb15e7b8e -->

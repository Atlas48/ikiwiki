ikiwiki's simple podcasting, while elegant and minimal, doesn't (as
mentioned in [[todo/blogging]]) produce full-featured feeds. In
fancy podcasts, episodes are accompanied by text content. The feeds
also have lots more metadata.

[[!toc]]

## Design

7. For each fancy podcast episode, write a blog post containing
   `\[[!meta enclosure="WikiLink/to/media.mp3"]]`. (Don't specify
   more than one enclosure -- but if you do, last one wins.)
7. When rendering to HTML (single-page or inlined), append a link
   to the media file.
7. When rendering to RSS/Atom, the text is the entry's content and
   the media file is its enclosure.
7. Don't break simple podcasts in pursuit of fancy podcasts.

## Implementation

[[!template id=gitbranch branch=schmonz/fancypodcast author="[[schmonz]]"]]

### Completed

* Cover the existing simple podcast behavior with tests.
* Add an `enclosure` field to [[plugins/meta]] that expands the
  given [[ikiwiki/WikiLink]] to an absolute URL (feed enclosures
  pretty much need to be, and the reference feeds I've looked at
  all do this).
* Write failing tests for the desired single-page and inlined
  HTML behavior, then make them pass by adding enclosure stanzas
  to `{,inline}page.tmpl`.
* Write failing tests for the desired RSS/Atom behavior, then make
  them pass via changes to `{atom,rss}item.tmpl` and [[plugins/inline]].

### Must-have (for [[schmonz]], anyway)

* Enrich podcast feed metadata (some of which is iTunes-specific,
  though I'm not aware of it causing any problems for other
  podcatchers, and in fact some of them may also use it).
* Subscribe to a fancy feed in some common podcatchers and compare
  display details against a reference podcast.
* Compare feature-for-feature and feed-for-feed with
  [tru_podcast](http://www.rainskit.com/blog/542/tru_podcast-a-podcasting-plugin-for-textpattern),
  which is what [[schmonz]] will be migrating from.
* Think carefully about...
    * UTF-8.
    * Other templates with `CONTENT` and whether they want to learn
      about `ENCLOSURE` (maybe `aggregatepost.tmpl`?).
    * Whether [[tips/howto avoid flooding aggregators]] suffices for
      migrating a fancy podcast into ikiwiki.
* Verify that the feeds validate.
* Verify that _all_ the tests pass (not just my new ones).

### Nice-to-have

* Let the enclosure's MIME type be specified, in case someone ever
  needs to disagree with `File::MimeInfo`.
* Extend [[plugins/inline]] to configurably generate additional
  subscription links (such as iTunes) alongside the RSS/Atom ones.
* Verify that [[plugins/more]] plays well with fancy podcasts.
* Allow enclosures that are outside the wiki.

### Status

[[!table data="""
Feature            |iTunes RSS|iTunes Atom|Downcast RSS|Downcast Atom
Feed image         |    -     |     -     |     -      |     -
Feed title         |    +     |     +     |     +      |     +
Feed publisher     |    -     |     -     |     -      |     -
Feed "category"    |    -     |     -     |     -      |     -
Feed date          |    +     |     +     |     +      |     +
Feed description   |    -     |     -     |     -      |     -
Episode image      |    -     |     -     |     -      |     -
Episode title      |    +     |     +     |     +      |     +
Episode date       |    +     |     +     |     +      |     +
Episode duration   |    -     |     -     |     -      |     -
Episode author     |    +     |     +     |     +      |     +
Episode description|    +     |     +     |     +      |     -
Episode enclosure  |    +     |     +     |     +      |     +
"""]]

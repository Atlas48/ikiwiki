Instead of having files foo.html "in front of" foo/, I prefer to have foo/index.html. This patch allows that. Specifically, foo/index.type is translated to $links{'foo/'}, and bestlink looks for either "foo" or "foo/" when linking to pages. There are other miscellaneous changes that go with that -- parentlinks for "foo/" are the same as for "foo", except one directory higher; basename of "foo/" is "foo"; links to "foo/" are translated to "foo/index.html" rather than "foo/.html". (Links to "foo/" might be preferred, but that causes an infinite loop in writefile, because apparently dirname("foo/") == "foo/" on my system for reasons that aren't clear to me.)

    Index: IkiWiki/Render.pm
    ===================================================================
    --- IkiWiki/Render.pm       (revision 1497)
    +++ IkiWiki/Render.pm       (working copy)
    @@ -40,6 +40,10 @@
        my $path="";
        my $skip=1;
        return if $page eq 'index'; # toplevel
    +   if ($page =~ m{/$}){
    +           $page =~s{/$}{};
    +           $path="..";
    +   }
        foreach my $dir (reverse split("/", $page)) {
                if (! $skip) {
                        $path.="../";
    Index: IkiWiki.pm
    ===================================================================
    --- IkiWiki.pm      (revision 1497)
    +++ IkiWiki.pm      (working copy)
    @@ -170,6 +170,7 @@
     sub basename ($) { #{{{
        my $file=shift;

    +   $file=~s!/$!!;
        $file=~s!.*/+!!;
        return $file;
     } #}}}
    @@ -196,12 +197,14 @@
        my $type=pagetype($file);
        my $page=$file;
        $page=~s/\Q.$type\E*$// if defined $type;
    +   $page=~s#index$## if $page=~m{/index$};
        return $page;
     } #}}}

     sub htmlpage ($) { #{{{
        my $page=shift;

    +   return $page."index.html" if $page=~m{/$};
        return $page.".html";
     } #}}}

    @@ -264,6 +267,7 @@
        my $page=shift;
        my $link=shift;

    +   $page =~ s!/$!!;
        my $cwd=$page;
        do {
                my $l=$cwd;
    @@ -273,6 +277,9 @@
                if (exists $links{$l}) {
                        return $l;
                }
    +           if (exists $links{$l.'/'}){
    +                   return $l.'/';
    +           }
                elsif (exists $pagecase{lc $l}) {
                        return $pagecase{lc $l};
                }
